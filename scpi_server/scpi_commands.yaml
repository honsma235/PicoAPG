---
# Copyright (c) 2026 honsma235
# SPDX-License-Identifier: GPL-2.0-only
#
# See the repository LICENSE file for the full text.

# SCPI Command Definitions
# has_query: true auto-generates "?" query version
# Commands with "?" in name are query-only
# indices: list of indexed parameters with ranges
#
# Implementation Status:
#   - No 'status' field: Command is implemented (stub not generated)

# ============================================================================
# Output Control Commands
# ============================================================================

- command: ":OUTPut:STATe"
  has_query: true
  description: "Enable/disable output drivers"
  details: "ON: outputs enabled (idle state when not running); OFF: all outputs set to input/Hi-Z"
  params:
    - name: "state"
      type: "bool"
      default: false

- command: ":ABORt"
  has_query: false
  description: "Abort generation"
  details: "Stops ongoing operation and returns to IDLE (armed). Outputs remain enabled if OUTPut:STATe is ON"
  params: []


# ============================================================================
# Trigger Source and Control Commands
# ============================================================================

- command: ":TRIGger:SOURce"
  has_query: true
  description: "Set/Query trigger source"
  params:
    - name: "trg_source"
      type: "enum"
      values: ["IMM", "INT", "BUS"]
      default: "BUS"
  details: "IMM: immediate trigger (always armed); INT: internal periodic trigger; BUS: trigger via *TRG"

- command: ":TRIGger:DELay"
  has_query: true
  description: "Set/Query trigger delay"
  params:
    - name: "delay"
      type: "float"
      min: 0.0
      max: 1000.0
      default: 0.0
  details: "Idle time in seconds after trigger event before operation starts"

- command: "*TRG"
  has_query: false
  description: "IEEE-488 bus trigger"
  details: "Bus trigger signal; Requires :TRIGger:SOURce to be set to BUS."
  params: []

# ============================================================================
# Execution Mode Commands
# ============================================================================

- command: ":SOURce:BURSt:TYPE"
  has_query: true
  description: "Set/Query burst type"
  params:
    - name: "burst_mode"
      type: "enum"
      values: ["CONTinuous", "NCYCles", "DURation"]
      default: "CONTinuous"
  details: "CONTINUOUS: no burst, run continuously; NCYCLES: run N cycles then auto-stop; TIMED: run for duration then auto-stop; Will abort ongoing operation when changed"

- command: ":SOURce:BURSt:NCYCles"
  has_query: true
  description: "Set/Query number of burst cycles to generate"
  params:
    - name: "ncycles"
      type: "uint"
      min: 1
      max: 4000000000
      default: 1
  details: "Number of complete burst cycles to generate before auto-stopping (used with burst type NCYCles)"

- command: ":SOURce:BURSt:DURation"
  has_query: true
  description: "Set/Query burst run duration"
  params:
    - name: "duration"
      type: "float"
      min: 0.0001
      max: 3600.0
      default: 0.01
  details: "Time in seconds to run burst before auto-stopping (used with burst type DURation)"

- command: ":SOURce:BURSt:INTerval"
  has_query: true
  description: "Set/Query internal trigger interval"
  params:
    - name: "interval"
      type: "float"
      min: 1e-4
      max: 60.0
      default: 1
  details: "Cycle time for internal trigger source.; Applies when :TRIGger:SOURce INT"

- command: ":SOURce:BURSt:FREQuency"
  has_query: true
  description: "Set/Query internal trigger frequency"
  params:
    - name: "frequency"
      type: "float"
      min: 0.01667
      max: 1000000.0
      default: 1
  details: "Frequency of internal trigger source.; Reciprocal of INTerval.; Applies when :TRIGger:SOURce INT"

# ============================================================================
# PWM Configuration Commands
# ============================================================================

- command: ":SOURce:PWM:MODE"
  has_query: true
  description: "Set/Query PWM operating mode"
  params:
    - name: "pwm_mode"
      type: "enum"
      values: ["OFF", "ONEPH", "TWOPH", "THREEPH"]
      default: "OFF"
  details: "OFF: disables PWM; ONEPH: single phase, only DUTY control available; TWOPH: two-phase; THREEPH: three-phase; Requires outputs OFF to change mode."

- command: ":SOURce:PWM:CONTrol"
  has_query: true
  description: "Set/Query control mode"
  params:
    - name: "pwm_control"
      type: "enum"
      values: ["DUTY", "MOD_ANGLE", "MOD_SPEED"]
      default: "DUTY"
  details: "DUTY: set DUTY cycle directly; MOD_ANGLE: set MODulation index & phase ANGLE; MOD_SPEED: set MODulation index & phase rotation SPEED; In ONEPH mode, only DUTY control is available.; Requires PWM stopped to change."

- command: ":SOURce:PWM:FREQuency"
  has_query: true
  description: "Set/Query PWM carrier frequency"
  params:
    - name: "frequency"
      type: "float"
      min: 10
      max: 200000
      default: 10000
  details: "Frequency in Hz; Must be >= 2x current :SOURce:PWM:SPEED.; Requires PWM stopped to change."

- command: ":SOURce:PWM:DEADtime"
  has_query: true
  description: "Set/Query PWM deadtime"
  params:
    - name: "deadtime"
      type: "float"
      min: 0
      max: 1
      default: 1E-6
  details: "Deadtime in seconds between high-side and low-side switching.; Added half to high-side and half to low-side pulse.; Requires PWM stopped to change."

- command: ":SOURce:PWM:MINDuty"
  has_query: true
  description: "Set/Query minimum duty cycle"
  params:
    - name: "min"
      type: "float"
      min: 0.0
      max: 0.4
      default: 0.05
  details: "Maximum is symmetrically limited to (1.0 - MIN).; Will be enforced in MOD_xx control modes too.; Requires PWM stopped to change."

- command: ":SOURce:PWM:PHase<n>:LS"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query low-side GPIO assignment"
  params:
    - name: "gpio"
      type: "int"
      min: -1
      max: 22
      default: -1
  details: "GPIO pin number; Use -1 for unused (will be set to input/Hi-Z).; The 16 available PWM channels are mapped to GPIO 0–15 and mirrored on GPIO 16–31. Consequently, GPIO n and GPIO n+16 are linked to the same channel and cannot be controlled independently.; Requires outputs OFF to change."

- command: ":SOURce:PWM:PHase<n>:HS"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query high-side GPIO assignment"
  params:
    - name: "gpio"
      type: "int"
      min: -1
      max: 22
      default: -1
  details: "GPIO pin number; Use -1 for unused (will be set to input/Hi-Z).; The 16 available PWM channels are mapped to GPIO 0–15 and mirrored on GPIO 16–31. Consequently, GPIO n and GPIO n+16 are linked to the same channel and cannot be controlled independently.; Requires outputs OFF to change."

- command: ":SOURce:PWM:PHase<n>:LS:INVert"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query low-side GPIO inversion; Will also affect idle state"
  params:
    - name: "invert"
      type: "bool"
      default: false
  details: "0 or OFF: normal; 1 or ON: inverted; Requires PWM stopped to change."

- command: ":SOURce:PWM:PHase<n>:HS:INVert"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query high-side GPIO inversion; Will also affect idle state"
  params:
    - name: "invert"
      type: "bool"
      default: false
  details: "0 or OFF: normal; 1 or ON: inverted; Requires PWM stopped to change."

- command: ":SOURce:PWM:PHase<n>:LS:IDLe"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query low-side idle output state"
  params:
    - name: "state"
      type: bool
      default: false
  details: "0 or OFF: output low when PWM not running; 1 or ON: output high when pwm not running; Requires PWM stopped to change."

- command: ":SOURce:PWM:PHase<n>:HS:IDLe"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query high-side idle output state"
  params:
    - name: "state"
      type: bool
      default: false
  details: "0 or OFF: output low when PWM not running; 1 or ON: output high when pwm not running; Requires PWM stopped to change."

# ============================================================================
# PWM Runtime / Modulation Commands
# ============================================================================

- command: ":SOURce:PWM:PHase<n>:DUTY"
  has_query: true
  indices:
    - name: "n"
      range: "1-3"
  description: "Set/Query duty-cycle"
  details: "Use fraction (0.0 to 1.0); 0.0 = LS always on, 1.0 = HS always on"
  params:
    - name: "duty"
      type: "float"
      min: 0.0
      max: 1.0
      default: 0.5

- command: ":SOURce:PWM:MOD"
  has_query: true
  description: "Set/Query modulation index"
  details: "Modulation index for SPWM (0.0 to 1.0); The generated duty cycle will be: 0.5 + 0.5 * MOD * sin(angle), but capped to respect MIN/MAX duty cycle."
  params:
    - name: "mod"
      type: "float"
      min: 0.0
      max: 1.0
      default: 0

- command: ":SOURce:PWM:ANGLE"
  has_query: true
  description: "Set/Query SPWM angle"
  details: "Phase angle in degrees (wraps at 360°); 0° = Phase 1 high"
  params:
    - name: "angle"
      type: "float"
      default: 0

- command: ":SOURce:PWM:SPEED"
  has_query: true
  description: "Set/Query SPWM rotation speed"
  params:
    - name: "speed"
      type: "float"
      min: 1E-3
      max: 100000
      default: 1
  details: "Rotation speed of SPWM phase in Hz (one rotation per second); Must be <= :SOURce:PWM:FREQuency/2."

